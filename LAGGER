local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local backpack = player:WaitForChild("Backpack")

local FRAME_SIZE = UDim2.new(0, 160, 0, 60)
local BUTTON_SIZE = UDim2.new(0, 140, 0, 35)
local POSITION = UDim2.new(1, -170, 0, 10) -- Top right position

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "LAGGER_GUI"
screenGui.DisplayOrder = 1000
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = FRAME_SIZE
mainFrame.Position = POSITION
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 6)
corner.Parent = mainFrame

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(80, 80, 80)
stroke.Thickness = 1
stroke.Parent = mainFrame

mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local activateButton = Instance.new("TextButton")
activateButton.Name = "ActivateButton"
activateButton.Size = BUTTON_SIZE
activateButton.Position = UDim2.new(0.5, -70, 0.5, -17)
activateButton.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
activateButton.BorderSizePixel = 0
activateButton.Text = "LAGGER"
activateButton.TextColor3 = Color3.fromRGB(255, 255, 255)
activateButton.TextScaled = true
activateButton.Font = Enum.Font.GothamBold

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 4)
buttonCorner.Parent = activateButton

activateButton.Parent = mainFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(1, -10, 0, 15)
statusLabel.Position = UDim2.new(0, 5, 1, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Ready"
statusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
statusLabel.TextSize = 11
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = mainFrame

local isActive = false
local currentCharacter = nil

local function updateStatus(text, color)
    statusLabel.Text = text
    statusLabel.TextColor3 = color or Color3.fromRGB(150, 150, 150)
end

local function findSlapTools()
    local slapTools = {}
    
    for _, tool in pairs(backpack:GetChildren()) do
        if tool:IsA("Tool") and (string.find(string.lower(tool.Name), "slap") or string.find(string.lower(tool.Name), "hand") or string.find(string.lower(tool.Name), "glove")) then
            table.insert(slapTools, tool)
        end
    end
    
    if currentCharacter then
        for _, tool in pairs(currentCharacter:GetChildren()) do
            if tool:IsA("Tool") and (string.find(string.lower(tool.Name), "slap") or string.find(string.lower(tool.Name), "hand") or string.find(string.lower(tool.Name), "glove")) then
                table.insert(slapTools, tool)
            end
        end
    end
    
    return slapTools
end

local function equipAllSlapTools(slapTools)
    if not currentCharacter then return false end
    
    local humanoid = currentCharacter:FindFirstChild("Humanoid")
    if humanoid then
        humanoid:UnequipTools()
        task.wait(0.1)
    end
    
    for _, tool in pairs(slapTools) do
        tool.Parent = currentCharacter
    end
    
    return true
end

local function useAllSlapTools(slapTools)
    if not currentCharacter then return end
    
    updateStatus("Using tools...", Color3.fromRGB(255, 100, 100))
    
    for i = 1, 10 do
        for _, tool in pairs(slapTools) do
            if tool.Parent == currentCharacter then
                pcall(function()
                    for _, child in pairs(tool:GetChildren()) do
                        if child:IsA("RemoteEvent") then
                            if child.Name == "Activate" or child.Name == "Slap" or 
                               child.Name == "Attack" or child.Name == "Hit" then
                                child:FireServer()
                            end
                        end
                    end
                    
                    for _, part in pairs(tool:GetDescendants()) do
                        if part:IsA("ClickDetector") then
                            fireclickdetector(part)
                        end
                    end
                    
                    if tool:FindFirstChild("Activate") then
                        tool.Activate:Fire()
                    end
                end)
            end
        end
        task.wait(0.05)
    end
end

local function activateLagger()
    if isActive then return end
    isActive = true
    
    activateButton.Text = "ACTIVE"
    activateButton.BackgroundColor3 = Color3.fromRGB(40, 180, 40)
    updateStatus("Starting...", Color3.fromRGB(255, 200, 50))
    
    local slapTools = findSlapTools()
    
    if #slapTools == 0 then
        updateStatus("No tools found", Color3.fromRGB(255, 100, 100))
        activateButton.Text = "LAGGER"
        activateButton.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
        isActive = false
        return
    end
    
    updateStatus("Equipping all...", Color3.fromRGB(50, 200, 255))
    task.wait(0.1)
    
    equipAllSlapTools(slapTools)
    task.wait(0.2)
    
    useAllSlapTools(slapTools)
    task.wait(0.5)
    
    -- Removed rejoin function
    
    updateStatus("Complete", Color3.fromRGB(50, 200, 50))
    task.wait(1)
    
    activateButton.Text = "LAGGER"
    activateButton.BackgroundColor3 = Color3.fromRGB(180, 40, 40)
    updateStatus("Ready", Color3.fromRGB(150, 150, 150))
    isActive = false
end

activateButton.MouseButton1Click:Connect(activateLagger)

if player.Character then
    currentCharacter = player.Character
end
player.CharacterAdded:Connect(function(char)
    currentCharacter = char
end)

local UserInputService = game:GetService("UserInputService")
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.G then
        activateLagger()
    end
end)

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton3 then
        mainFrame.Visible = not mainFrame.Visible
    end
end)

print("=== LAGGER LOADED ===")
print("Click button or press G key")
print("Will: 1) Equip ALL slap tools, 2) Use them")
print("GUI positioned at top right")
